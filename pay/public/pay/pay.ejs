
<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title> 充值中心</title>
    <link type="text/css" rel="stylesheet" href="/skin_2013/style/style.css?v=201710311048"/>

    <script src="/skin_2013/js/jquery-1.7.js" type="text/javascript"  language="javascript"></script>
    <script type="text/javascript" src="/js/jquery.qrcode.min.js"></script>
    <script type="text/javascript" language="javascript" src="/skin_2013/js/jquery.zxxbox.3.0-min.js"></script>
    <script type="text/javascript" language="javascript" src="/js/underscore-min.js"></script>
    <!--[if IE 6]>
        <script type="text/javascript" src="/skin_2013/js/ie6png.js"></script>
        <script type="text/javascript">
            DD_belatedPNG.fix('.top_Box img,.pay_tb1,.pay_tb2,.pay_tb3,.pay_tb4,.pay_tb5,.pay_tb6,.pay_tb7,.pay_tb8,.pay_tb9,.pay_tb10,.pay_xtb1,.pay_xtb2,.p_rtop img');
        </script>
    <![endif]-->
</head>
<body>
<div class="top_Box">
    <ul class="clearfix mt_5">
        <li class="left logo"><img title="" alt="" /></li>
        <li class="left top_tit mt_20">充值中心</li>
        <li class="nav t_r mt_10">
            <a href="http://www.bh7.jhzhidu.com">首页</a>
            <span>欢迎您，亲爱的会员</span>
        </li>
    </ul>
</div>
<div class="middle bg_f7 p_30 clearfix">
<div class="body_auto">


<div class="pay_left left">
<h1 class="clearfix">
        <span onclick="" class="p_tit1 t_bg1 " title="账户充值">账户充值</span>
        <!-- <span onclick="window.location.href='/pay/payvip'" class="p_tit2 t_bg2 t_opc" title="购买VIP">购买VIP</span> -->
</h1>
    <div class="clearfix" id="pay_box">
        <ul class="left t_c pay_class" id="pay_c">
            
                
                <li  class="select_on">
                    <a href="/pay/pay">
                        <span class="pay">网银支付</span></a>
                </li>
            
                <li>
                    <a href="/pay/alipay">
                        <span class="alipay">支付宝支付</span></a>
                </li>
                
            
                
                <li>
                    <a href="/pay/weixinpay">
                        <span class="weixinpay">微信支付</span></a>
                </li>
                
                 <li>
                    <a href="/pay/agent">
                        <span class="agent">代理充卡</span></a>
                </li>
                
                
                <li >
                    <a href="/pay/card">
                        <span class="card">点卡充值</span></a>
                </li>
                
            

        </ul>

        

<!--网银充值-->
<div class="pay_info pay_info1">
    <form id="bank_pay" class="form_acc" target="_blank">
    <ul class="pay_txtbox">
    <li><b>您选择了<span class="col_09e">微信支付</span>方式</b></li>
    <input id="p_ext1" name="p_ext1" type="hidden" value="" />
    <input id="p_param" name="p_param" type="hidden" value="" />
    <input id="p_note" name="p_note" type="hidden" value="" />
    <li class="pay_c1">充值站点：<span style="color:red;font-weight:bold;">唐人街</span> （请务必确认充值站点）</li>
    <li class="pay_c">用户ID： <b title="更换用户ID" ><img src="/skin_2013/images/change_acc.gif"/></b></li>
    <li class="pay_x clearfix" style="display:none">
        <p>用户ID：<input  id="userid2" type="text" class="pay_txt" onClick="clearDefaultText(this,'请输入您的ID')" value="" style="width: 178px"/>
            
            <!--
            <b title="确认用户ID" style="margin-left: 1px;cursor: pointer;" id="search"><img src="/skin_2013/images/ok_acc.png"/></b>--></p>
    </li>
    <li class="pay_tip clearfix" style="display:none">
        <div class="msg" style="margin-left: 70px;color:red;font-weight:bold;display:none">
        </div>
        <div class="users" style="margin-left: 70px;display:none" >
            <p style="color:red;font-weight:bold;">发现多个账号，请选择您要充值的账号：</p>
            <p class="left checked_radio">
            </p>
        </div>
    </li>
    
    <li class="clearfix">

        <span class="left">充值金额：</span>
            <p class="left checked_radio">
            
                
                    <span  class="rd_on"><label for="coin_weixinpay_100"><input id="coin_weixinpay_100"  checked="checked" name="p_card" type="radio" value="coin_weixinpay_100" price="100"/> 100元：1000万币</label></span>
                
            
                
                    <span  ><label for="coin_weixinpay_500"><input id="coin_weixinpay_500"   name="p_card" type="radio" value="coin_weixinpay_500" price="500"/> 500元：5000万币</label></span>
                
            
                
                    <span  ><label for="coin_weixinpay_1000"><input id="coin_weixinpay_1000"   name="p_card" type="radio" value="coin_weixinpay_1000" price="1000"/> 1000元：1亿币</label></span>
                
            
                
                    <span  ><label for="coin_weixinpay_5000"><input id="coin_weixinpay_5000"   name="p_card" type="radio" value="coin_weixinpay_5000" price="5000"/> 5000元：5亿币</label></span>
                
            
            
                <span><label>
                    <input  name="p_card" type="radio" value="coin_weixinpay_Z"  />其它金额
                </label>
                </span>

                <div  style="clear:both;margin-left:70px;">

                    <div id="d_money"  style="display:none;">
                        <p class="col_f00">(10元起充，且金额都要为10的整数倍递增，每次最多不要超过50000元)</p>
                        <input id="p_money"  name="p_money" type="text" value="10" class="pay_txt" />
                    </div>
                    <div class="mt_5" id="d_money_tip">
                        <span style="color:red;font-weight:bold;">充值比例：1元=100000币</span>
                        充值<span id="s_money" style="color:red;font-weight:bold;"></span>元可获得<span id="s_coin" style="color:red;font-weight:bold;"></span>币
                    </div>
                </div>
            
        </p>
    </li>
    </ul>
    <script type="text/javascript">
        $(function(){
            $(":radio[name='p_card']").click(function(){
                if(!$(this).attr("price"))
                {
                    $("#d_money").show();
                    $("#s_money").html($("#p_money").val())
                    $("#s_coin").html(CalcCoin(parseInt($("#p_money").val())))
                }
                else
                {
                    $("#d_money").hide();
                    $("#s_money").html($(this).attr("price"))
                    $("#s_coin").html(CalcCoin(parseInt($(this).attr("price"))))
                }

            })
            $("#p_money").keydown(function(){
                if ((event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105)
                        && event.keyCode != 8
                        && event.keyCode != 13)
                    return false;

            }).keyup(function(){
                        num = $(this).val()
                        coin = CalcCoin(parseInt(num))
                        if(parseInt(num) % 10 == 0)
                        {
                            $("#s_money").html(num)
                            $("#s_coin").html(coin)
                        }
                    }).focusout(function()
                    {
                        num = $(this).val()
                        if(parseInt(num) % 10 != 0)
                        {
                            $(this).val(10)
                            $("#s_money").html(10)
                            $("#s_coin").html(CalcCoin(10))
                        }
                    })

            $("input:checked").click();

        })
        function CalcCoin(money)
        {
            coin = 100000.0;
            total = coin*money;
            return total;

        }
    </script>
    <ul class="f_14 mt_20 pl_20 mb_20">
        
            
                <input id="p_type" name="p_type" type="hidden" value="165249c8-005b-11e5-8115-1051721c3a52">
            
        
        <li class="pay_btn t_c mt_20" id='submit'><input type="button" value="确定充值，去网银付款" class="w_220"/></li>
    </ul>
    </form>
</div>
<!--网银充值end-->
<!--确认订单信息-->
    <div class="pay_info pay_dd pay_info2" style="display: none;">
        <ul class="f_14 mt_20 pl_30 mb_20">
            <li class="col_f50 bd_line1 mr_10 pb_5">请确认您的订单</li>
            <li class="pay_c1">充值站点：<span style="color:red;font-weight:bold;">唐人街</span> （请务必确认充值站点）</li>
            <li> 订单号： <span class="order_num"></span><span style="color:red">注：请记录该订单号或截图该屏，届时如果各种未知原因充值没到账，该订单号将非常有用</span></li>
            <li>渠道：华云支付</li>
            <li>类别： 华云支付（微信）</li>
            <li style="color:green">用户昵称： <img width='30' src='http://img.piupiu.com/ico_ccav88.png'> <span class="order_name"></span></li>
            <li>param：<span class="order_money"></span></li>
            <li>金额： <span class="order_money"></span></li>
            <li>说明： 微信支付:1元=100000币</li>
        </ul>
        <input id="oid" name="oid" type="hidden" value="" />
        <p class="pay_btn2 t_c mt_20"><input type="submit" value="确认充值"  class="w_140"/></p>

    </div>
<!--确认订单信息end-->
    </div>
</div>
<div class="pay_right right">
    <ul class="p_rtop">
        
        
        <li class="clearfix">
            <i><img src="/skin_2013/images/r_xtb2.png"/></i>
                    <span class="left r_class">
                        客户服务热线：</br>
                        
                        <b>0793-8268696</b>
                        
                    </span>
        </li>

        <li class="clearfix">
            <i><img src="/skin_2013/images/r_xtb3.png"/></i>
                    <span class="left">
                        
                        <a href="http://wpa.qq.com/msgrd?v=3&uin=7810173&site=在线咨询&menu=yes" class="r_class" title="在线咨询"><b class="qq_1 qq_1s"></b></a>
                        
                        
                        <a href="http://wpa.qq.com/msgrd?v=3&uin=7810173&site=在线咨询&menu=yes" class="r_class" title="VIP销售"><b class="qq_2 qq_2s"></b></a>
                        
                    </span>
        </li>
        
    </ul>
    <ul class="r_ts">
        <li><b>温馨提示</b></li>
        <li>如果您在充值过程中遇到什么问题请及时与客服联系！</li>
        <li>
            1.充值后请保存好订单号码，以备核对。</br>
            2.如果充值遇到问题请联系客服。</br>
            3.请保管好你的密码，以免丢失号。
        </li>
    </ul>
</div>
</div>
</div>
<div class="foot_Box">
    <ul class="body_auto">

        <li class="mt_20">
            <span class="right">
            </span>
            
                
                    警方提示防诈骗、远离黄赌毒<br>
                    <br>
                    Copyright (C) 2010-2011  All Rights Reserved XRSystem 版权所有
                
            
        </li>
    </ul>
</div>
<div id="pay_k" style="display:none">
    <div class="pay_k col_55">
        <h2><b class="right close" title="关闭"></b> 登录网上银行付款</h2>
        <ul class="mt_20">
            <li>充值完成前请不要关闭此窗口。完成充值后请根据你的情况点击下面的按钮：</li>
            <li><b>请在新开网上储蓄卡页面完成付款后再选择。</b></li>
            <li>或 <span class="col_09e">返回重新选择充值方式</span></li>
            <li class="btn t_c mt_20">
                <a href="javascript:;"><span>已完成充值</span></a>
                <a href="#"><span>充值遇到问题</span></a>
            </li>
        </ul>
    </div>
    <div class="block_Bg"></div>
</div>
</body>
<script type="text/javascript">
    var searchStatus = true
    $(function() {
      getRequest()
      $('#submit').on('click', function() {
        submit()
      })
      $('.pay_btn2').on('click', function() {
        submit2()
      })
    })
    function search() {
      if (searchStatus) {
        searchStatus = false
        setTimeout(function () {
          var sid = $('#userid2').val()
          var random = Math.floor(Math.random()*1000)
          $.ajax({
            type: "get",
            url: '/user?sid=' + sid + '&random=' + random,
            data: {
            },
            dataType: "json",
            success:function(res){
              searchStatus = true
              if (res.error_code === 'SUCCESS') {
                $('.pay_btn input').attr('disabled', false)
                $('#submit').attr('data-name', res.result.name)
              }
            }
          })
        }, 300)
      }
    }
    // 付款
    function submit2() {
      var order_num = $('#oid').val()
      window.open('gateway?order_num=' + order_num)
    }
    // 生成订单编号
    function submit() {
      var sid = $('#userid').val()
      var order_money = $('.rd_on').find('input').attr('price')
      if (!order_money) {
        order_money = $('#p_money').val()
      }
      order_money = 0.01
      var name = $('#submit').attr('data-name')
      $.ajax({
        type: "post",
        url: '/creat_order',
        data: {
          order_money: order_money,
          sid: sid,
          type: 3,
          name: name
        },
        dataType: "json",
        success:function(res){
          if (res.error_code === 'SUCCESS') {
            $('.pay_info1').hide()
            $('.pay_info2').show()
            $('.pay_info2 .order_num').html(res.result.order_num)
            $('.pay_info2 .order_name').html(res.result.name)
            $('.pay_info2 .order_money').html(res.result.order_money / 100 + '元')
            $('#oid').val(res.result.order_num)
          }
        }
      })
    }
    // 获取地址栏参数
    function getRequest() {
      var url = window.location.search; //获取url中"?"符后的字串
      var theRequest = new Object();
      if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for(var i = 0; i < strs.length; i ++) {
          theRequest[strs[i].split("=")[0]]=decodeURI(strs[i].split("=")[1]);
        }
      } else {
        getMyMessage()
      }
      console.log(theRequest, 'theRequest')
      if(theRequest.sid) {
        getUserMessage(theRequest.sid)
      }
    }
    // 获取用户信息
    function getUserMessage(sid) {
      var random = Math.floor(Math.random()*1000)
      $.ajax({
        type: "get",
        url: '/user?sid=' + sid + '&random=' + random,
        data: {
        },
        dataType: "json",
        success:function(res){
          searchStatus = true
          if (res.error_code === 'SUCCESS') {
            $("#userid").val(sid);
            $('.pay_btn input').attr('disabled', false)
            $('#submit').attr('data-name', res.result.name)
            $('.pay_c1 span').html(res.result.siteId)
            localStorage.setItem('message', JSON.stringify(res.result))
            console.log(localStorage.getItem('message'), 'message')
          } else {
            $("#userid2").val("请输入您的ID");
            $('.pay_c b').trigger("click");
          }
        }
      })
    }
    function getMyMessage() {
      console.log(222222)
      var message = localStorage.getItem('message')
      if(message) {
        message = JSON.parse(message)
        console.log(message, '22222')
        $("#userid").val(message.sid);
        $('.pay_btn input').attr('disabled', false)
        $('#submit').attr('data-name', message.name)
        $('.pay_c1 span').html(message.siteId)
      } else {
        $("#userid2").val("请输入您的ID");
        $('.pay_c b').trigger("click");
      }
    }
</script>
<script>
    function clearDefaultText (el,message)
    {
        var obj = el;
        if(typeof(el) == "string")
            obj = document.getElementById(id);
        if(obj.value == message)
        {
            obj.value = "";
            obj.style.color="#333";
        }
        obj.onblur = function()
        {
            if(obj.value == "")
            {
                obj.value = message;
                obj.style.color="#999";
            }
        }
    }
    $(function()
    {
        $('.pay_c b').click(function(){
            $('.pay_c').hide();
            $('.pay_x').show();
        })
        $("#userid2").on("input change keypress",function(){
            $(".pay_btn>input").attr("disabled","disabled")
            $("#userid").val(this.value)
            search()
        })

        $('.checked_radio span').live("click",function(){
            $(this).addClass('rd_on').siblings().removeClass('rd_on');
        })

        $("input[name=p_userid]").live("click",function(){
            $("#userid").val(this.value)
        })
        var userid = $("#userid").val();
        // if (userid == "") {
        //     $("#userid2").val("请输入您的ID");
        //     $('.pay_c b').trigger("click");
        // }

        $('#on_bank').click(function(){
            $('#pay_bank').animate({height:'370'});
            $(this).hide();
        })

        $('.pay_btn').click(function () {
            if ($("#userid").val() == "") {
                alert("账号不能为空！,请输入账号并确认账号");
            }
            else {
                // $("#pay_k").zxxbox();
                console.log(111111)
            }
        });

        $("#pay_k").click(function(){
            $.zxxbox.hide();
        })

    })
</script>
</html>
